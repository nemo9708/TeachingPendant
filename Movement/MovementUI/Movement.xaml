<UserControl x:Class="TeachingPendant.MovementUI.Movement"
             xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
             xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
             xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006" 
             xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
             xmlns:local="clr-namespace:TeachingPendant.MovementUI"
             mc:Ignorable="d" 
             Background="LightGray"
             BorderBrush="Black" BorderThickness="1">

    <Grid Margin="5">
        <Grid.RowDefinitions>
            <RowDefinition Height="Auto"/>
            <!-- Group 선택 영역 -->
            <RowDefinition Height="*"/>
            <!-- 메인 콘텐츠 영역 -->
        </Grid.RowDefinitions>

        <!-- Group 선택 영역 -->
        <Grid Grid.Row="0">
            <Grid.RowDefinitions>
                <RowDefinition Height="Auto"/>
                <RowDefinition Height="Auto"/>
            </Grid.RowDefinitions>
            <Grid.ColumnDefinitions>
                <ColumnDefinition Width="Auto"/>
                <ColumnDefinition Width="*"/>
            </Grid.ColumnDefinitions>

            <ComboBox x:Name="cmbGroups" Grid.Column="0" Width="70" Height="25" Margin="2" 
                      SelectionChanged="GroupComboBox_SelectionChanged"
                      VerticalContentAlignment="Center"/>

            <!-- 숨겨진 Alarm 텍스트블록 -->
            <TextBlock x:Name="txtAlarmMessage" Grid.Column="1" Visibility="Collapsed"/>
            
            <!-- Start/Stop 버튼 및 실시간 좌표 -->
            <StackPanel Grid.Row="1" Grid.Column="0" Grid.ColumnSpan="2" Orientation="Horizontal" 
                Margin="0,10,0,0" HorizontalAlignment="Left">

                <!-- Start/Stop 버튼 -->
                <Button x:Name="btnAutoStart" Content="Start" Width="60" Height="25" 
                Margin="0,0,5,0" Click="AutoStart_Click" 
                BorderBrush="Green" BorderThickness="2" Background="LightGreen"/>

                <Button x:Name="btnAutoStop" Content="Stop" Width="60" Height="25" 
                Margin="0,0,15,0" Click="AutoStop_Click"
                BorderBrush="Red" BorderThickness="2" Background="LightPink"/>

                <!-- 실시간 좌표 표시 -->
                <TextBlock Text="Current:" VerticalAlignment="Center" Margin="0,0,5,0" FontWeight="Bold"/>

                <TextBlock Text="R:" VerticalAlignment="Center" Margin="0,0,2,0"/>
                <TextBlock x:Name="txtCurrentR" Text="0.00" Width="50" VerticalAlignment="Center" 
                   Margin="0,0,8,0" FontFamily="Consolas" Foreground="Blue" FontWeight="Bold"/>

                <TextBlock Text="T:" VerticalAlignment="Center" Margin="0,0,2,0"/>
                <TextBlock x:Name="txtCurrentT" Text="0.00" Width="50" VerticalAlignment="Center" 
                   Margin="0,0,8,0" FontFamily="Consolas" Foreground="Blue" FontWeight="Bold"/>

                <TextBlock Text="A:" VerticalAlignment="Center" Margin="0,0,2,0"/>
                <TextBlock x:Name="txtCurrentA" Text="0.00" Width="50" VerticalAlignment="Center" 
                   Margin="0,0,8,0" FontFamily="Consolas" Foreground="Blue" FontWeight="Bold"/>

                <!-- 좌표 표시 영역 근처에 배치하는 것이 좋습니다 -->

                <GroupBox Header="좌표 미세 조정 (데드맨 스위치)" FontWeight="Bold" Margin="5" Background="LightCyan">
                    <Grid Margin="5">
                        <Grid.RowDefinitions>
                            <RowDefinition Height="Auto"/>
                            <RowDefinition Height="Auto"/>
                            <RowDefinition Height="Auto"/>
                            <RowDefinition Height="Auto"/>
                        </Grid.RowDefinitions>

                        <!-- 안내 메시지 -->
                        <TextBlock Grid.Row="0"
                   Text="1️⃣ 조정할 좌표를 클릭하여 선택"
                   FontSize="12"
                   FontWeight="SemiBold"
                   Foreground="DarkBlue"
                   Margin="0,0,0,5"/>

                        <TextBlock Grid.Row="1"
                   Text="2️⃣ 조정 버튼을 누르고 있으면 1씩 증가"
                   FontSize="12"
                   FontWeight="SemiBold"
                   Foreground="DarkBlue"
                   Margin="0,0,0,10"/>

                        <!-- 좌표 조정 버튼 (데드맨 스위치) -->
                        <Button x:Name="btnCoordinateAdjust" 
                Grid.Row="2"
                Content="좌표 조정" 
                Width="140" 
                Height="60" 
                Margin="5"
                Background="LightSteelBlue"
                BorderBrush="SteelBlue"
                BorderThickness="3"
                FontWeight="Bold"
                FontSize="16"
                ToolTip="1. 먼저 조정할 좌표(P1A, P1T 등)를 클릭하세요&#x0a;2. 이 버튼을 누르고 있으면 좌표가 1씩 증가합니다&#x0a;3. 버튼을 놓으면 즉시 중단됩니다 (데드맨 스위치)"
                PreviewMouseLeftButtonDown="CoordinateAdjustButton_PreviewMouseLeftButtonDown"
                PreviewMouseLeftButtonUp="CoordinateAdjustButton_PreviewMouseLeftButtonUp"
                MouseLeave="CoordinateAdjustButton_MouseLeave"/>

                        <!-- 안전 안내 텍스트 -->
                        <StackPanel Grid.Row="3" Orientation="Vertical" Margin="5">
                            <TextBlock Text="⚠️ 데드맨 스위치: 버튼을 놓으면 즉시 중단"
                       FontSize="10"
                       Foreground="OrangeRed"
                       TextAlignment="Center"
                       FontStyle="Italic"/>

                            <TextBlock Text="🛡️ 소프트 리미트 도달시 자동 중단"
                       FontSize="10"
                       Foreground="Green"
                       TextAlignment="Center"
                       FontStyle="Italic"/>
                        </StackPanel>
                    </Grid>
                </GroupBox>

                <!-- 슬롯 추적 UI 추가 -->
                <TextBlock Text="Slot:" VerticalAlignment="Center" Margin="0,0,5,0" FontWeight="Bold"/>
                <TextBlock x:Name="txtCurrentSlot" Text="1" VerticalAlignment="Center" 
               Width="20" TextAlignment="Center" Margin="0,0,2,0" 
               FontWeight="Bold" Foreground="DarkBlue"/>
                <TextBlock Text="/" VerticalAlignment="Center" Margin="0,0,2,0"/>
                <TextBlock x:Name="txtTotalSlots" Text="1" VerticalAlignment="Center" 
               Width="20" TextAlignment="Center" Margin="0,0,15,0" 
               FontWeight="Bold" Foreground="DarkGreen"/>

                <!-- 현재 실행 상태 표시 -->
                <TextBlock Text="Status:" VerticalAlignment="Center" Margin="15,0,5,0" FontWeight="Bold"/>
                <TextBlock x:Name="txtAutoStatus" Text="Stopped" VerticalAlignment="Center" 
                   FontWeight="Bold" Foreground="Red"/>
                
            </StackPanel>
        </Grid>

        <!-- 메인 콘텐츠 영역 -->
        <Grid Grid.Row="1" Margin="0,10,0,0">
            <Grid.ColumnDefinitions>
                <ColumnDefinition Width="Auto"/>
                <ColumnDefinition Width="*"/>
            </Grid.ColumnDefinitions>

            <!-- 왼쪽 부분 - Group 선택 패널 또는 Group 상세 메뉴 -->
            <Border Grid.Column="0" BorderBrush="Black" BorderThickness="1">
                <Grid>
                    <!-- Group 목록 화면 -->
                    <Grid x:Name="GroupListPanel" Visibility="Visible">
                        <Grid.RowDefinitions>
                            <RowDefinition Height="*"/>
                            <RowDefinition Height="Auto"/>
                            <RowDefinition Height="Auto"/>
                            <RowDefinition Height="Auto"/>
                        </Grid.RowDefinitions>

                        <!-- Group 목록 -->
                        <ListBox x:Name="lstGroups" Grid.Row="0" Margin="5" Height="150"
                                 SelectionChanged="GroupListBox_SelectionChanged"
                                 ScrollViewer.VerticalScrollBarVisibility="Auto">
                            <ListBox.ItemContainerStyle>
                                <Style TargetType="ListBoxItem">
                                    <Setter Property="Padding" Value="10,8"/>
                                    <Setter Property="FontSize" Value="12"/>
                                    <Style.Triggers>
                                        <Trigger Property="IsSelected" Value="True">
                                            <Setter Property="Background" Value="LightBlue"/>
                                            <Setter Property="FontWeight" Value="Bold"/>
                                        </Trigger>
                                    </Style.Triggers>
                                </Style>
                            </ListBox.ItemContainerStyle>
                        </ListBox>

                        <!-- 버튼들 -->
                        <Button x:Name="btnOpen" Grid.Row="1" Content="OPEN" 
                                Height="30" Margin="5,2"
                                Click="OpenButton_Click"
                                BorderBrush="Gray" BorderThickness="1"/>

                        <Button x:Name="btnAdd" Grid.Row="2" Content="ADD" 
                                Height="30" Margin="5,2"
                                Click="AddButton_Click"
                                BorderBrush="Gray" BorderThickness="1"/>

                        <Button x:Name="btnDel" Grid.Row="3" Content="DEL"
                                Height="30" Margin="5,2,5,5"
                                Click="DeleteButton_Click"  
                                BorderBrush="Gray" BorderThickness="1"/>
                    </Grid>

                    <!-- Group 상세 메뉴 -->
                    <StackPanel x:Name="GroupDetailPanel" Visibility="Collapsed" Margin="5">
                        <TextBlock x:Name="txtCurrentGroup" Text="GROUP1" 
                                   FontWeight="Bold" FontSize="14" 
                                   HorizontalAlignment="Center" Margin="0,5,0,15"/>

                        <!-- 메뉴 버튼들 -->
                        <Button x:Name="btnCPick" Content="C Pick" Width="100" Height="30" 
                                Margin="0,2" Click="CPick_Click"
                                BorderBrush="Gray" BorderThickness="1"/>
                        <Button x:Name="btnCPlace" Content="C Place" Width="100" Height="30" 
                                Margin="0,2" Click="CPlace_Click"
                                BorderBrush="Gray" BorderThickness="1"/>
                        <Button x:Name="btnSPlace" Content="S Place" Width="100" Height="30" 
                                Margin="0,2" Click="SPlace_Click"
                                BorderBrush="Gray" BorderThickness="1"/>
                        <Button x:Name="btnSPick" Content="S Pick" Width="100" Height="30" 
                                Margin="0,2" Click="SPick_Click"
                                BorderBrush="Gray" BorderThickness="1"/>
                        <Button x:Name="btnAligner" Content="Aligner" Width="100" Height="30" 
                                Margin="0,2" Click="Aligner_Click"
                                BorderBrush="Gray" BorderThickness="1"/>

                        <Button x:Name="btnSaveGroup" Content="SAVE" Width="100" Height="30" 
                                Margin="0,15,0,2" Click="SaveGroup_Click"
                                BorderBrush="Gray" BorderThickness="1"/>

                        <!-- 뒤로가기 버튼 -->
                        <Button x:Name="btnBack" Content="◀ BACK" Width="100" Height="25" 
                                Margin="0,10,0,0" Click="BackButton_Click"
                                BorderBrush="Gray" BorderThickness="1"
                                FontSize="10"/>
                    </StackPanel>
                </Grid>
            </Border>

            <!-- 오른쪽 부분 - 좌표 표시 영역 -->
            <Border Grid.Column="1" BorderBrush="Black" BorderThickness="1">
                <Grid>
                    <!-- 좌표 표시 영역 -->
                    <ScrollViewer x:Name="CoordinateScrollViewer" 
                                  VerticalScrollBarVisibility="Auto" 
                                  MaxHeight="400" 
                                  Visibility="Collapsed">
                        <Grid Margin="10">
                            <Grid.RowDefinitions>
                                <RowDefinition Height="Auto"/>
                                <RowDefinition Height="Auto"/>
                                <RowDefinition Height="Auto"/>
                                <RowDefinition Height="Auto"/>
                                <RowDefinition Height="Auto"/>
                                <RowDefinition Height="Auto"/>
                                <RowDefinition Height="Auto"/>
                                <RowDefinition Height="Auto"/>
                            </Grid.RowDefinitions>

                            <!-- P1-P7 좌표 입력 영역 -->
                            <!-- P1 좌표 -->
                            <StackPanel Grid.Row="0" Orientation="Horizontal" Margin="0,2">
                                <TextBlock Text="P1  " VerticalAlignment="Center" Width="25"/>
                                <TextBlock Text="R :" VerticalAlignment="Center" Margin="0,0,5,0" Width="20"/>
                                <TextBox x:Name="txtP1A" Text="0.00" Width="50" Margin="0,0,10,0" TextAlignment="Center" VerticalContentAlignment="Center"/>
                                <TextBlock Text="T(°) :" VerticalAlignment="Center" Margin="0,0,5,0"/>
                                <TextBox x:Name="txtP1T" Text="0.00" Width="50" Margin="0,0,10,0" TextAlignment="Center" VerticalContentAlignment="Center"/>
                                <TextBlock Text="Z :" VerticalAlignment="Center" Margin="0,0,5,0"/>
                                <TextBox x:Name="txtP1Z" Text="0.00" Width="50" TextAlignment="Center" VerticalContentAlignment="Center"/>
                                <TextBlock Text="Speed :" VerticalAlignment="Center" Margin="10,0,5,0"/>
                                <TextBox x:Name="txtP1Speed" Text="100" Width="50" TextAlignment="Center" VerticalContentAlignment="Center"/>
                            </StackPanel>

                            <!-- P2 좌표 -->
                            <StackPanel Grid.Row="1" Orientation="Horizontal" Margin="0,2">
                                <TextBlock Text="P2  " VerticalAlignment="Center" Width="25"/>
                                <TextBlock Text="R :" VerticalAlignment="Center" Margin="0,0,5,0" Width="20"/>
                                <TextBox x:Name="txtP2A" Text="0.00" Width="50" Margin="0,0,10,0" TextAlignment="Center" VerticalContentAlignment="Center"/>
                                <TextBlock Text="T(°) :" VerticalAlignment="Center" Margin="0,0,5,0"/>
                                <TextBox x:Name="txtP2T" Text="0.00" Width="50" Margin="0,0,10,0" TextAlignment="Center" VerticalContentAlignment="Center"/>
                                <TextBlock Text="Z :" VerticalAlignment="Center" Margin="0,0,5,0"/>
                                <TextBox x:Name="txtP2Z" Text="0.00" Width="50" TextAlignment="Center" VerticalContentAlignment="Center"/>
                                <TextBlock Text="Speed :" VerticalAlignment="Center" Margin="10,0,5,0"/>
                                <TextBox x:Name="txtP2Speed" Text="100" Width="50" TextAlignment="Center" VerticalContentAlignment="Center"/>
                            </StackPanel>

                            <!-- P3 좌표 -->
                            <StackPanel Grid.Row="2" Orientation="Horizontal" Margin="0,2">
                                <TextBlock Text="P3  " VerticalAlignment="Center" Width="25"/>
                                <TextBlock Text="R :" VerticalAlignment="Center" Margin="0,0,5,0" Width="20"/>
                                <TextBox x:Name="txtP3A" Text="0.00" Width="50" Margin="0,0,10,0" TextAlignment="Center" VerticalContentAlignment="Center"/>
                                <TextBlock Text="T(°) :" VerticalAlignment="Center" Margin="0,0,5,0"/>
                                <TextBox x:Name="txtP3T" Text="0.00" Width="50" Margin="0,0,10,0" TextAlignment="Center" VerticalContentAlignment="Center"/>
                                <TextBlock Text="Z :" VerticalAlignment="Center" Margin="0,0,5,0"/>
                                <TextBox x:Name="txtP3Z" Text="0.00" Width="50" TextAlignment="Center" VerticalContentAlignment="Center"/>
                                <TextBlock Text="Speed :" VerticalAlignment="Center" Margin="10,0,5,0"/>
                                <TextBox x:Name="txtP3Speed" Text="100" Width="50" TextAlignment="Center" VerticalContentAlignment="Center"/>
                            </StackPanel>

                            <!-- P4 좌표 -->
                            <StackPanel Grid.Row="3" Orientation="Horizontal" Margin="0,2">
                                <TextBlock Text="P4  " VerticalAlignment="Center" Width="25"/>
                                <TextBlock Text="R :" VerticalAlignment="Center" Margin="0,0,5,0" Width="20"/>
                                <TextBox x:Name="txtP4A" Text="0.00" Width="50" Margin="0,0,10,0" TextAlignment="Center" VerticalContentAlignment="Center"/>
                                <TextBlock Text="T(°) :" VerticalAlignment="Center" Margin="0,0,5,0"/>
                                <TextBox x:Name="txtP4T" Text="0.00" Width="50" Margin="0,0,10,0" TextAlignment="Center" VerticalContentAlignment="Center"/>
                                <TextBlock Text="Z :" VerticalAlignment="Center" Margin="0,0,5,0"/>
                                <TextBox x:Name="txtP4Z" Text="0.00" Width="50" TextAlignment="Center" VerticalContentAlignment="Center"/>
                                <TextBlock Text="Speed :" VerticalAlignment="Center" Margin="10,0,5,0"/>
                                <TextBox x:Name="txtP4Speed" Text="100" Width="50" TextAlignment="Center" VerticalContentAlignment="Center"/>
                            </StackPanel>

                            <!-- P5 좌표 -->
                            <StackPanel Grid.Row="4" Orientation="Horizontal" Margin="0,2">
                                <TextBlock Text="P5  " VerticalAlignment="Center" Width="25"/>
                                <TextBlock Text="R :" VerticalAlignment="Center" Margin="0,0,5,0" Width="20"/>
                                <TextBox x:Name="txtP5A" Text="0.00" Width="50" Margin="0,0,10,0" TextAlignment="Center" VerticalContentAlignment="Center"/>
                                <TextBlock Text="T(°) :" VerticalAlignment="Center" Margin="0,0,5,0"/>
                                <TextBox x:Name="txtP5T" Text="0.00" Width="50" Margin="0,0,10,0" TextAlignment="Center" VerticalContentAlignment="Center"/>
                                <TextBlock Text="Z :" VerticalAlignment="Center" Margin="0,0,5,0"/>
                                <TextBox x:Name="txtP5Z" Text="0.00" Width="50" TextAlignment="Center" VerticalContentAlignment="Center"/>
                                <TextBlock Text="Speed :" VerticalAlignment="Center" Margin="10,0,5,0"/>
                                <TextBox x:Name="txtP5Speed" Text="100" Width="50" TextAlignment="Center" VerticalContentAlignment="Center"/>
                            </StackPanel>

                            <!-- P6 좌표 -->
                            <StackPanel Grid.Row="5" Orientation="Horizontal" Margin="0,2">
                                <TextBlock Text="P6  " VerticalAlignment="Center" Width="25"/>
                                <TextBlock Text="R :" VerticalAlignment="Center" Margin="0,0,5,0" Width="20"/>
                                <TextBox x:Name="txtP6A" Text="0.00" Width="50" Margin="0,0,10,0" TextAlignment="Center" VerticalContentAlignment="Center"/>
                                <TextBlock Text="T(°) :" VerticalAlignment="Center" Margin="0,0,5,0"/>
                                <TextBox x:Name="txtP6T" Text="0.00" Width="50" Margin="0,0,10,0" TextAlignment="Center" VerticalContentAlignment="Center"/>
                                <TextBlock Text="Z :" VerticalAlignment="Center" Margin="0,0,5,0"/>
                                <TextBox x:Name="txtP6Z" Text="0.00" Width="50" TextAlignment="Center" VerticalContentAlignment="Center"/>
                                <TextBlock Text="Speed :" VerticalAlignment="Center" Margin="10,0,5,0"/>
                                <TextBox x:Name="txtP6Speed" Text="100" Width="50" TextAlignment="Center" VerticalContentAlignment="Center"/>
                            </StackPanel>

                            <!-- P7 좌표 -->
                            <StackPanel Grid.Row="6" Orientation="Horizontal" Margin="0,2">
                                <TextBlock Text="P7  " VerticalAlignment="Center" Width="25"/>
                                <TextBlock Text="R :" VerticalAlignment="Center" Margin="0,0,5,0" Width="20"/>
                                <TextBox x:Name="txtP7A" Text="0.00" Width="50" Margin="0,0,10,0" TextAlignment="Center" VerticalContentAlignment="Center"/>
                                <TextBlock Text="T(°) :" VerticalAlignment="Center" Margin="0,0,5,0"/>
                                <TextBox x:Name="txtP7T" Text="0.00" Width="50" Margin="0,0,10,0" TextAlignment="Center" VerticalContentAlignment="Center"/>
                                <TextBlock Text="Z :" VerticalAlignment="Center" Margin="0,0,5,0"/>
                                <TextBox x:Name="txtP7Z" Text="0.00" Width="50" TextAlignment="Center" VerticalContentAlignment="Center"/>
                                <TextBlock Text="Speed :" VerticalAlignment="Center" Margin="10,0,5,0"/>
                                <TextBox x:Name="txtP7Speed" Text="100" Width="50" TextAlignment="Center" VerticalContentAlignment="Center"/>
                            </StackPanel>

                            <!-- Cassette/Stage 영역 -->
                            <StackPanel Grid.Row="7" Orientation="Horizontal" Margin="0,15,0,5" Background="LightYellow">
                                <TextBlock x:Name="txtCassetteLabel" Text="Cassette :" VerticalAlignment="Center" Width="60" FontWeight="Bold"/>
                                <ComboBox x:Name="cmbCassette" Width="50" Height="25" Margin="5,0,10,0" 
                                          SelectionChanged="CassetteComboBox_SelectionChanged" 
                                          VerticalContentAlignment="Center"/>
                                <TextBlock Text="Slot :" VerticalAlignment="Center" Margin="10,0,5,0"/>
                                <TextBlock x:Name="txtCassetteSlot" Text="1" Width="30" VerticalAlignment="Center" FontWeight="Bold"/>
                                <TextBlock Text="Position :" VerticalAlignment="Center" Margin="15,0,5,0"/>
                                <TextBlock x:Name="txtCassettePosition" Text="(0.00, 0.00, 0.00)" 
                                           VerticalAlignment="Center" FontWeight="Bold" Foreground="DarkBlue"/>
                            </StackPanel>
                        </Grid>
                    </ScrollViewer>

                    <!-- 빈 영역 표시 -->
                    <Grid x:Name="EmptyCoordinateArea" Visibility="Visible">
                        <TextBlock Text="Select Group and click OPEN to display coordinates" 
                                   HorizontalAlignment="Center" 
                                   VerticalAlignment="Center"
                                   FontSize="14" FontStyle="Italic"
                                   Foreground="Gray"/>
                    </Grid>
                </Grid>
            </Border>
        </Grid>
    </Grid>
</UserControl>